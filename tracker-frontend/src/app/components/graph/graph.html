<div class="graph-container">
  <svg #svgGraph [attr.viewBox]="viewBoxString()" preserveAspectRatio="xMidYMid meet">
    <g class="flip-y" [attr.transform]="flipTransform()">
      <g class="path">
        <polyline
          [attr.points]="polylinePoints()"
          fill="none"
          stroke="red"
          stroke-linejoin="round"
          class="path-polyline"
          stroke-dasharray="2.2"
          vector-effect="non-scaling-stroke"
        />
      </g>
      <g class="axis">
        <line
          x1="0"
          [attr.y1]="viewBox().minY - viewBox().height"
          x2="0"
          [attr.y2]="viewBox().maxY + viewBox().height"
          stroke="gray"
          vector-effect="non-scaling-stroke"
        />
        <line
          [attr.x1]="viewBox().minX - viewBox().width"
          y1="0"
          [attr.x2]="viewBox().maxX + viewBox().width"
          y2="0"
          stroke="gray"
          vector-effect="non-scaling-stroke"
        />
      </g>

      <g class="markers">
        <circle [attr.cx]="startPoint().x" [attr.cy]="startPoint().y" r="1" fill="red" />
        <text
          [attr.x]="startPoint().x + 2"
          [attr.y]="-startPoint().y"
          class="text"
          transform="scale(1 -1)"
          vector-effect="non-scaling-stroke"
        >
          Start
        </text>

        <circle [attr.cx]="endPoint().x" [attr.cy]="endPoint().y" r="1" fill="red" />
        <text
          [attr.x]="endPoint().x + 2"
          [attr.y]="-endPoint().y"
          class="text"
          transform="scale(1 -1)"
          vector-effect="non-scaling-stroke"
        >
          End
        </text>
      </g>

      <g class="current">
        <circle [attr.cx]="currentLocation().x" [attr.cy]="currentLocation().y" r="1" fill="blue">
          <animate attributeName="r" values="2;3;2" dur="1.2s" repeatCount="indefinite" />
        </circle>
      </g>

      <g class="offset">
        @if (status().closestPoint) {
          <line
            [attr.x1]="status().closestPoint?.x"
            [attr.y1]="status().closestPoint?.y"
            [attr.x2]="currentLocation().x"
            [attr.y2]="currentLocation().y"
            vector-effect="non-scaling-stroke"
            stroke="blue"
            class="offset-line"
          />
        }
      </g>
    </g>
  </svg>
</div>
